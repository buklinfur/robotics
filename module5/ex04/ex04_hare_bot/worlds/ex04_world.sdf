<?xml version="1.0"?>
<sdf version="1.9">
  <world name="ex04">
    <physics name="default_physics" type="dart">
      <max_step_size>0.001</max_step_size>
      <real_time_factor>1.0</real_time_factor>
    </physics>

    <!-- Земля -->
    <model name="ground_plane">
      <static>true</static>
      <link name="link">
        <collision name="collision">
          <geometry>
            <plane>
              <normal>0 0 1</normal>
              <size>100 100</size>
            </plane>
          </geometry>
        </collision>
        <visual name="visual">
          <geometry>
            <plane>
              <normal>0 0 1</normal>
              <size>100 100</size>
            </plane>
          </geometry>
        </visual>
      </link>
    </model>

    <!-- ===== ROBOT (по твоему xacro) =====
         base_x=0.25 base_y=0.18 base_z=0.35
         wheel_r=0.06 wheel_w=0.04
         wheel_x_front=0.09 wheel_x_rear=-0.09
         wheel_y_offset=0.11
         base_origin_z = 0.06 + 0.35/2 = 0.235
    -->
    <model name="robot_hare_wheel_bot">
      <!-- ВАЖНО: z=0 => колёса центром на z=0.06 касаются земли -->
      <pose>0 0 0 0 0 0</pose>

      <link name="base_link">
        <inertial>
          <pose>0 0 0.235 0 0 0</pose>
          <mass>3.5</mass>
          <inertia>
            <ixx>0.12</ixx><ixy>0</ixy><ixz>0</ixz>
            <iyy>0.12</iyy><iyz>0</iyz>
            <izz>0.15</izz>
          </inertia>
        </inertial>

        <collision name="base_collision">
          <pose>0 0 0.235 0 0 0</pose>
          <geometry><box><size>0.25 0.18 0.35</size></box></geometry>
        </collision>

        <visual name="base_visual">
          <pose>0 0 0.235 0 0 0</pose>
          <geometry><box><size>0.25 0.18 0.35</size></box></geometry>
          <material>
            <ambient>0.6 0.6 0.7 1</ambient>
            <diffuse>0.6 0.6 0.7 1</diffuse>
          </material>
        </visual>
      </link>

      <!-- HEAD -->
      <link name="head_link">
        <!-- head_joint origin: 0 0 (base_origin_z + base_z/2) = 0.235+0.175=0.41 -->
        <pose>0 0 0.41 0 0 0</pose>
        <inertial>
          <mass>1.0</mass>
          <inertia>
            <ixx>0.02</ixx><ixy>0</ixy><ixz>0</ixz>
            <iyy>0.02</iyy><iyz>0</iyz>
            <izz>0.02</izz>
          </inertia>
        </inertial>

        <collision name="head_collision">
          <!-- head_origin_z=0.06 -->
          <pose>0 0 0.06 0 0 0</pose>
          <geometry><box><size>0.16 0.14 0.12</size></box></geometry>
        </collision>

        <visual name="head_visual">
          <pose>0 0 0.06 0 0 0</pose>
          <geometry><box><size>0.16 0.14 0.12</size></box></geometry>
          <material>
            <ambient>0.5 0.5 0.6 1</ambient>
            <diffuse>0.5 0.5 0.6 1</diffuse>
          </material>
        </visual>
      </link>

      <joint name="head_joint" type="fixed">
        <parent>base_link</parent>
        <child>head_link</child>
      </joint>

      <!-- EARS (fixed к head_link) -->
      <link name="left_ear">
        <pose>0 0 0.41 0 0 0</pose>
        <inertial>
          <mass>0.1</mass>
          <inertia>
            <ixx>0.0002</ixx><ixy>0</ixy><ixz>0</ixz>
            <iyy>0.0002</iyy><iyz>0</iyz>
            <izz>0.0001</izz>
          </inertia>
        </inertial>
        <collision name="c">
          <pose>0 0.035 0.16 0 0 0</pose>
          <geometry><cylinder><radius>0.03</radius><length>0.12</length></cylinder></geometry>
        </collision>
        <visual name="v">
          <pose>0 0.035 0.16 0 0 0</pose>
          <geometry><cylinder><radius>0.03</radius><length>0.12</length></cylinder></geometry>
          <material><diffuse>1.0 0.9 0.2 1</diffuse></material>
        </visual>
      </link>

      <joint name="left_ear_joint" type="fixed">
        <parent>head_link</parent>
        <child>left_ear</child>
      </joint>

      <link name="right_ear">
        <pose>0 0 0.41 0 0 0</pose>
        <inertial>
          <mass>0.1</mass>
          <inertia>
            <ixx>0.0002</ixx><ixy>0</ixy><ixz>0</ixz>
            <iyy>0.0002</iyy><iyz>0</iyz>
            <izz>0.0001</izz>
          </inertia>
        </inertial>
        <collision name="c">
          <pose>0 -0.035 0.16 0 0 0</pose>
          <geometry><cylinder><radius>0.03</radius><length>0.12</length></cylinder></geometry>
        </collision>
        <visual name="v">
          <pose>0 -0.035 0.16 0 0 0</pose>
          <geometry><cylinder><radius>0.03</radius><length>0.12</length></cylinder></geometry>
          <material><diffuse>1.0 0.9 0.2 1</diffuse></material>
        </visual>
      </link>

      <joint name="right_ear_joint" type="fixed">
        <parent>head_link</parent>
        <child>right_ear</child>
      </joint>

      <!-- ARMS (fixed к base_link) -->
      <link name="left_arm">
        <pose>0 0 0 0 0 0</pose>
        <inertial>
          <mass>0.3</mass>
          <inertia>
            <ixx>0.005</ixx><ixy>0</ixy><ixz>0</ixz>
            <iyy>0.005</iyy><iyz>0</iyz>
            <izz>0.005</izz>
          </inertia>
        </inertial>

        <!-- arm_origin_z = base_origin_z + base_z/2 - arm_z/2 = 0.235+0.175-0.10=0.31 -->
        <collision name="c">
          <pose>0 0.09 0.31 0 0 0</pose>
          <geometry><box><size>0.05 0.05 0.20</size></box></geometry>
        </collision>
        <visual name="v">
          <pose>0 0.09 0.31 0 0 0</pose>
          <geometry><box><size>0.05 0.05 0.20</size></box></geometry>
          <material><diffuse>0.5 0.5 0.6 1</diffuse></material>
        </visual>
      </link>

      <joint name="left_arm_joint" type="fixed">
        <parent>base_link</parent>
        <child>left_arm</child>
      </joint>

      <link name="right_arm">
        <pose>0 0 0 0 0 0</pose>
        <inertial>
          <mass>0.3</mass>
          <inertia>
            <ixx>0.005</ixx><ixy>0</ixy><ixz>0</ixz>
            <iyy>0.005</iyy><iyz>0</iyz>
            <izz>0.005</izz>
          </inertia>
        </inertial>

        <collision name="c">
          <pose>0 -0.09 0.31 0 0 0</pose>
          <geometry><box><size>0.05 0.05 0.20</size></box></geometry>
        </collision>
        <visual name="v">
          <pose>0 -0.09 0.31 0 0 0</pose>
          <geometry><box><size>0.05 0.05 0.20</size></box></geometry>
          <material><diffuse>0.5 0.5 0.6 1</diffuse></material>
        </visual>
      </link>

      <joint name="right_arm_joint" type="fixed">
        <parent>base_link</parent>
        <child>right_arm</child>
      </joint>

    <!-- ===== WHEELS ===== -->
<link name="front_left_wheel_link">
  <!-- колесо сидит ровно на joint-фрейме -->
  <pose relative_to="front_left_wheel_joint">0 0 0 0 0 0</pose>

  <inertial>
    <mass>0.25</mass>
    <inertia>
      <ixx>0.003</ixx><ixy>0</ixy><ixz>0</ixz>
      <iyy>0.003</iyy><iyz>0</iyz>
      <izz>0.003</izz>
    </inertia>
  </inertial>

  <collision name="c">
    <!-- цилиндр повернут как в URDF -->
    <pose>0 0 0 1.5708 0 0</pose>
    <geometry><cylinder><radius>0.06</radius><length>0.04</length></cylinder></geometry>
    <surface>
      <friction><ode><mu>1.2</mu><mu2>1.2</mu2></ode></friction>
    </surface>
  </collision>

  <visual name="v">
    <pose>0 0 0 1.5708 0 0</pose>
    <geometry><cylinder><radius>0.06</radius><length>0.04</length></cylinder></geometry>
  </visual>
</link>

<link name="front_right_wheel_link">
  <pose relative_to="front_right_wheel_joint">0 0 0 0 0 0</pose>
  <inertial><mass>0.25</mass>
    <inertia><ixx>0.003</ixx><ixy>0</ixy><ixz>0</ixz><iyy>0.003</iyy><iyz>0</iyz><izz>0.003</izz></inertia>
  </inertial>
  <collision name="c">
    <pose>0 0 0 1.5708 0 0</pose>
    <geometry><cylinder><radius>0.06</radius><length>0.04</length></cylinder></geometry>
    <surface><friction><ode><mu>1.2</mu><mu2>1.2</mu2></ode></friction></surface>
  </collision>
  <visual name="v">
    <pose>0 0 0 1.5708 0 0</pose>
    <geometry><cylinder><radius>0.06</radius><length>0.04</length></cylinder></geometry>
  </visual>
</link>

<link name="rear_left_wheel_link">
  <pose relative_to="rear_left_wheel_joint">0 0 0 0 0 0</pose>
  <inertial><mass>0.25</mass>
    <inertia><ixx>0.003</ixx><ixy>0</ixy><ixz>0</ixz><iyy>0.003</iyy><iyz>0</iyz><izz>0.003</izz></inertia>
  </inertial>
  <collision name="c">
    <pose>0 0 0 1.5708 0 0</pose>
    <geometry><cylinder><radius>0.06</radius><length>0.04</length></cylinder></geometry>
    <surface><friction><ode><mu>1.2</mu><mu2>1.2</mu2></ode></friction></surface>
  </collision>
  <visual name="v">
    <pose>0 0 0 1.5708 0 0</pose>
    <geometry><cylinder><radius>0.06</radius><length>0.04</length></cylinder></geometry>
  </visual>
</link>

<link name="rear_right_wheel_link">
  <pose relative_to="rear_right_wheel_joint">0 0 0 0 0 0</pose>
  <inertial><mass>0.25</mass>
    <inertia><ixx>0.003</ixx><ixy>0</ixy><ixz>0</ixz><iyy>0.003</iyy><iyz>0</iyz><izz>0.003</izz></inertia>
  </inertial>
  <collision name="c">
    <pose>0 0 0 1.5708 0 0</pose>
    <geometry><cylinder><radius>0.06</radius><length>0.04</length></cylinder></geometry>
    <surface><friction><ode><mu>1.2</mu><mu2>1.2</mu2></ode></friction></surface>
  </collision>
  <visual name="v">
    <pose>0 0 0 1.5708 0 0</pose>
    <geometry><cylinder><radius>0.06</radius><length>0.04</length></cylinder></geometry>
  </visual>
</link>

<!-- ===== JOINTS: ось вращения в base_link, ровно в центре колеса ===== -->
<joint name="front_left_wheel_joint" type="revolute">
  <parent>base_link</parent>
  <child>front_left_wheel_link</child>
  <pose relative_to="base_link">0.09 0.11 0.06 0 0 0</pose>
  <axis><xyz>0 1 0</xyz></axis>
</joint>

<joint name="front_right_wheel_joint" type="revolute">
  <parent>base_link</parent>
  <child>front_right_wheel_link</child>
  <pose relative_to="base_link">0.09 -0.11 0.06 0 0 0</pose>
  <axis><xyz>0 1 0</xyz></axis>
</joint>

<joint name="rear_left_wheel_joint" type="revolute">
  <parent>base_link</parent>
  <child>rear_left_wheel_link</child>
  <pose relative_to="base_link">-0.09 0.11 0.06 0 0 0</pose>
  <axis><xyz>0 1 0</xyz></axis>
</joint>

<joint name="rear_right_wheel_joint" type="revolute">
  <parent>base_link</parent>
  <child>rear_right_wheel_link</child>
  <pose relative_to="base_link">-0.09 -0.11 0.06 0 0 0</pose>
  <axis><xyz>0 1 0</xyz></axis>
</joint>

      <!-- DiffDrive: едет по /model/robot_hare_wheel_bot/cmd_vel -->
      <plugin filename="gz-sim-diff-drive-system" name="gz::sim::systems::DiffDrive">
        <left_joint>front_left_wheel_joint</left_joint>
        <left_joint>rear_left_wheel_joint</left_joint>
        <right_joint>front_right_wheel_joint</right_joint>
        <right_joint>rear_right_wheel_joint</right_joint>

        <wheel_separation>0.22</wheel_separation>
        <wheel_radius>0.06</wheel_radius>

        <topic>/model/robot_hare_wheel_bot/cmd_vel</topic>
        <odom_topic>/model/robot_hare_wheel_bot/odometry</odom_topic>
        <tf_topic>/model/robot_hare_wheel_bot/tf</tf_topic>
        <frame_id>odom</frame_id>
        <child_frame_id>base_link</child_frame_id>
        <odom_publish_frequency>50</odom_publish_frequency>
      </plugin>

      <!-- Joint states для ROS (/joint_states через bridge) -->
      <plugin filename="gz-sim-joint-state-publisher-system" name="gz::sim::systems::JointStatePublisher"/>
    </model>

  </world>
</sdf>
